---
title: "spmR-examples"
vignette: >
  %\VignetteIndexEntry{spmR-examples}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
  
lightbox: true
output: 
  # rmarkdown::html_vignette
  bookdown::html_document2:
    code_folding: hide
    fig_caption: yes
    number_sections: yes
    theme: readable
    highlight: tango
    code-summary: "Show the code"
    embed-resources: true
    toc: true
    toc-title: 'Contents'
    toc_float: yes
    number-sections: false
    code-fold: true
format:
  html:
        code-summary: "Show the code"
        embed-resources: true
        toc: true
        toc-title: 'Contents'
        number-sections: false
        code-fold: true
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set( collapse = TRUE, comment = "#>" )
knitr::opts_knit$set(root.dir = here::here())
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, results = FALSE, fig.width = 6, fig.height = 5)
```

```{r setupex}
library(spmR)
library(tidyverse)
library(patchwork)
here::here()

```
# Working examples of the spmR package

This vignette provides examples of how to use the spmR package to run the Standard Projection Model (SPM) for Alaska groundfish. The SPM is a stock assessment model used to project the future status of fish stocks. The spmR package provides an R interface to the SPM model, allowing users to run the model and analyze the results in R. There are three main functions in the spmR package: `runSPM`, `plotSPM`, and `dat2list` (and `list2dat`). The `runSPM` function runs the SPM model and returns the results as a data frame. The `plotSPM` function creates plots of the SPM results. 
The `list2dat` and `dat2list` functions convert between local R lists and datafiles used by SPM externally.
A draft function called `print_Tier3_tables` is set up to provide some capabilities to create
tables for markdown documents.
This vignette demonstrates how to use these functions to run the SPM model and analyze the results. 

# Example sets

The following case studies have been applied.

## Atka mackerel
```{r atka,eval=TRUE}
df <- runSPM(here::here("examples","atka"),run=FALSE)
#setwd("spmR")
plotSPM(df)
```


## BSAI northern rock sole
```{r bsaiNRS,eval=FALSE}
df <- runSPM(here::here("examples","BSAI NRS"),run=FALSE)
plotSPM(df)
```
## EBS pollock
```{r ebswp,eval=FALSE}
df <- runSPM(here::here("examples","ebspollock"),run=FALSE)
plotSPM(df)

```
## BSAI yellowfin sole
```{r fathead,eval=FALSE}
df <- runSPM(here::here("examples","yfs"),run=FALSE)
 plotSPM(df)

```
## GOA Flathead sole

First we'll run this model with only 3-years fixed catch assumed

```{r goa_fhs,eval=TRUE,echo=FALSE}
# df <- runSPM(here::here("examples","goa_flathead/maia"),run=TRUE)
df <- runSPM(here::here("examples","goa_flathead"),run=FALSE)
plotSPM(df,thisyr=2025)
# p1<- plotSPM(df)

```

Now let's use the utility to change the input files and re-run the model with 5-years fixed catch assumed.

```{r goa_fhs2,eval=TRUE,echo=FALSE}
inp <- spmR::dat2list(here::here("examples","goa_flathead","spm.dat"))
inp$nyrs_fixed_catch
inp$nyrs_fixed_catch <- 5
inp$fixed_catch <- rbind(inp$fixed_catch, c(2025, 1100), c(2026, 1100))
inp$fixed_catch
spmR::list2dat(inp,here::here("examples","goa_flathead","spm.dat"))
df <- runSPM(here::here("examples","goa_flathead"),run=TRUE)

plotSPM(df,thisyr=2024)
```


## GOA Rougheye blackspotted
```{r rougheye,eval=FALSE}

```
